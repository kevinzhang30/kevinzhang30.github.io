import{r as i,j as e,s as r}from"./index-tQ3HB7dr.js";const g={title:"",description:"",image_url:"",location:"",date:"",tags:"",category:"urban",sort_order:0};function q(){const[x,v]=i.useState([]),[n,d]=i.useState(null),[N,c]=i.useState(!1),[a,s]=i.useState(g),[p,h]=i.useState(!1),[b,f]=i.useState(!1);async function m(){if(!r)return;const{data:t}=await r.from("photos").select("*").order("sort_order");t&&v(t)}i.useEffect(()=>{m()},[]);function _(){d(null),s({...g,sort_order:x.length}),c(!0)}function w(t){d(t),s({title:t.title,description:t.description,image_url:t.image_url,location:t.location,date:t.date,tags:t.tags.join(", "),category:t.category,sort_order:t.sort_order}),c(!0)}function y(){d(null),s(g),c(!1)}async function C(t){const o=t.target.files?.[0];if(!o||!r)return;h(!0);const u=o.name.split(".").pop(),j=`${Date.now()}.${u}`,{error:U}=await r.storage.from("gallery").upload(j,o);if(!U){const{data:{publicUrl:E}}=r.storage.from("gallery").getPublicUrl(j);s({...a,image_url:E})}h(!1)}async function k(t){if(t.preventDefault(),!r)return;f(!0);const o={title:a.title,description:a.description,image_url:a.image_url,location:a.location,date:a.date,tags:a.tags.split(",").map(u=>u.trim()).filter(Boolean),category:a.category,sort_order:a.sort_order};n?await r.from("photos").update(o).eq("id",n.id):await r.from("photos").insert(o),f(!1),y(),m()}async function S(t){!r||!confirm("Delete this photo?")||(await r.from("photos").delete().eq("id",t),m())}const l="w-full rounded-lg border border-gray-200 px-3 py-2 text-sm outline-none focus:border-primary-300 focus:ring-2 focus:ring-primary-100";return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Gallery"}),e.jsx("button",{onClick:_,className:"rounded-lg bg-primary-500 px-3 py-1.5 text-sm font-medium text-white hover:bg-primary-600",children:"+ Add Photo"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4",children:x.map(t=>e.jsxs("div",{className:"group relative overflow-hidden rounded-xl border border-gray-200 bg-white",children:[e.jsx("div",{className:"aspect-square",children:e.jsx("img",{src:t.image_url,alt:t.title,className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.title}),e.jsx("p",{className:"text-xs text-gray-400",children:t.location})]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 transition-opacity group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>w(t),className:"rounded bg-white/90 px-2 py-1 text-xs font-medium text-primary-600 shadow-sm hover:bg-white",children:"Edit"}),e.jsx("button",{onClick:()=>S(t.id),className:"rounded bg-white/90 px-2 py-1 text-xs font-medium text-red-600 shadow-sm hover:bg-white",children:"Delete"})]})]},t.id))}),N&&e.jsxs("form",{onSubmit:k,className:"mt-6 space-y-4 rounded-xl border border-gray-200 bg-white p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:n?"Edit Photo":"New Photo"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Title"}),e.jsx("input",{required:!0,value:a.title,onChange:t=>s({...a,title:t.target.value}),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Location"}),e.jsx("input",{required:!0,value:a.location,onChange:t=>s({...a,location:t.target.value}),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Date"}),e.jsx("input",{type:"date",required:!0,value:a.date,onChange:t=>s({...a,date:t.target.value}),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Category"}),e.jsxs("select",{value:a.category,onChange:t=>s({...a,category:t.target.value}),className:l,children:[e.jsx("option",{value:"urban",children:"Urban"}),e.jsx("option",{value:"adventure",children:"Adventure"}),e.jsx("option",{value:"experience",children:"Experience"}),e.jsx("option",{value:"nature",children:"Nature"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:t=>s({...a,description:t.target.value}),rows:2,className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Tags (comma-separated)"}),e.jsx("input",{value:a.tags,onChange:t=>s({...a,tags:t.target.value}),placeholder:"city, nighttime, travel",className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Image"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{value:a.image_url,onChange:t=>s({...a,image_url:t.target.value}),placeholder:"URL or upload below",className:`flex-1 ${l}`}),e.jsxs("label",{className:"cursor-pointer rounded-lg border border-gray-200 px-3 py-2 text-sm text-gray-600 hover:bg-gray-50",children:[p?"Uploading...":"Upload",e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"hidden",disabled:p})]})]}),a.image_url&&e.jsx("img",{src:a.image_url,alt:"Preview",className:"mt-2 h-24 w-24 rounded-lg object-cover"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Sort Order"}),e.jsx("input",{type:"number",value:a.sort_order,onChange:t=>s({...a,sort_order:Number(t.target.value)}),className:"w-24 rounded-lg border border-gray-200 px-3 py-2 text-sm outline-none focus:border-primary-300 focus:ring-2 focus:ring-primary-100"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:b,className:"rounded-lg bg-primary-500 px-4 py-2 text-sm font-medium text-white hover:bg-primary-600 disabled:opacity-50",children:b?"Saving...":n?"Update":"Create"}),e.jsx("button",{type:"button",onClick:y,className:"rounded-lg px-4 py-2 text-sm text-gray-600 hover:bg-gray-100",children:"Cancel"})]})]})]})}export{q as default};
