import{r as i,j as e,s as a}from"./index-Dxmqf_26.js";function z(){const[v,V]=i.useState([]),[C,F]=i.useState({}),[_,w]=i.useState(null),[q,x]=i.useState(!1),[c,k]=i.useState(null),[u,g]=i.useState({code:"",country_name:""}),[D,f]=i.useState(!1),[p,j]=i.useState(null),[h,N]=i.useState(null),[s,o]=i.useState({city:"",date_range:"",purpose:"",category:"",description:"",highlights:"",image_url:"",sort_order:0}),[y,b]=i.useState(!1);async function m(){if(!a)return;const[{data:t},{data:d}]=await Promise.all([a.from("countries").select("*").order("country_name"),a.from("visits").select("*").order("sort_order")]);if(t&&V(t),d){const n={};for(const r of d)n[r.country_code]||(n[r.country_code]=[]),n[r.country_code].push(r);F(n)}}i.useEffect(()=>{m()},[]);function A(){k(null),g({code:"",country_name:""}),x(!0)}function T(t){k(t),g({code:t.code,country_name:t.country_name}),x(!0)}async function U(t){t.preventDefault(),a&&(b(!0),c?await a.from("countries").update({country_name:u.country_name}).eq("code",c.code):await a.from("countries").insert(u),b(!1),x(!1),m())}async function B(t){!a||!confirm("Delete this country and all its trips?")||(await a.from("countries").delete().eq("code",t),_===t&&w(null),m())}function L(t){N(null),j(t),o({city:"",date_range:"",purpose:"",category:"",description:"",highlights:"",image_url:"",sort_order:(C[t]??[]).length}),f(!0)}function P(t){N(t),j(t.country_code),o({city:t.city,date_range:t.date_range,purpose:t.purpose,category:t.category,description:t.description,highlights:t.highlights.join(", "),image_url:t.image_url??"",sort_order:t.sort_order}),f(!0)}function S(){f(!1),j(null),N(null)}async function R(t){if(t.preventDefault(),!a||!p)return;b(!0);const d={country_code:p,city:s.city,date_range:s.date_range,purpose:s.purpose,category:s.category,description:s.description,highlights:s.highlights.split(",").map(n=>n.trim()).filter(Boolean),image_url:s.image_url||null,sort_order:s.sort_order};h?await a.from("visits").update(d).eq("id",h.id):await a.from("visits").insert(d),b(!1),S(),m()}async function $(t){!a||!confirm("Delete this trip?")||(await a.from("visits").delete().eq("id",t),m())}const l="w-full rounded-lg border border-gray-200 px-3 py-2 text-sm outline-none focus:border-primary-300 focus:ring-2 focus:ring-primary-100";return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Travel"}),e.jsx("button",{onClick:A,className:"rounded-lg bg-primary-500 px-3 py-1.5 text-sm font-medium text-white hover:bg-primary-600",children:"+ Add Country"})]}),q&&e.jsxs("form",{onSubmit:U,className:"mb-6 space-y-4 rounded-xl border border-gray-200 bg-white p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c?"Edit Country":"New Country"}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"ISO Alpha-3 Code"}),e.jsx("input",{required:!0,maxLength:3,disabled:!!c,value:u.code,onChange:t=>g({...u,code:t.target.value.toUpperCase()}),className:`${l} ${c?"bg-gray-100":""}`,placeholder:"USA"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Country Name"}),e.jsx("input",{required:!0,value:u.country_name,onChange:t=>g({...u,country_name:t.target.value}),className:l})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",disabled:y,className:"rounded-lg bg-primary-500 px-4 py-2 text-sm font-medium text-white hover:bg-primary-600 disabled:opacity-50",children:y?"Saving...":c?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>x(!1),className:"rounded-lg px-4 py-2 text-sm text-gray-600 hover:bg-gray-100",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-3",children:v.map(t=>{const d=_===t.code,n=C[t.code]??[];return e.jsxs("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex cursor-pointer items-center justify-between px-4 py-3 hover:bg-gray-50",onClick:()=>w(d?null:t.code),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:`h-4 w-4 text-gray-400 transition-transform ${d?"rotate-90":""}`,fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 5 7 7-7 7"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t.country_name}),e.jsxs("p",{className:"text-xs text-gray-400",children:[t.code," · ",n.length," trip",n.length!==1?"s":""]})]})]}),e.jsxs("div",{className:"flex gap-2",onClick:r=>r.stopPropagation(),children:[e.jsx("button",{onClick:()=>T(t),className:"rounded px-2 py-1 text-xs text-primary-600 hover:bg-primary-50",children:"Edit"}),e.jsx("button",{onClick:()=>B(t.code),className:"rounded px-2 py-1 text-xs text-red-600 hover:bg-red-50",children:"Delete"})]})]}),d&&e.jsxs("div",{className:"border-t border-gray-100 bg-gray-50 px-4 py-3",children:[n.length===0&&e.jsx("p",{className:"text-sm text-gray-400",children:"No trips yet."}),e.jsx("div",{className:"space-y-2",children:n.map(r=>e.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-gray-200 bg-white px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:r.city}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.purpose," · ",r.date_range]}),r.description&&e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:r.description}),r.highlights.length>0&&e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1",children:r.highlights.map(E=>e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-0.5 text-xs text-gray-500",children:E},E))})]}),e.jsxs("div",{className:"flex flex-shrink-0 gap-2",children:[e.jsx("button",{onClick:()=>P(r),className:"rounded px-2 py-1 text-xs text-primary-600 hover:bg-primary-50",children:"Edit"}),e.jsx("button",{onClick:()=>$(r.id),className:"rounded px-2 py-1 text-xs text-red-600 hover:bg-red-50",children:"Delete"})]})]},r.id))}),e.jsx("button",{onClick:()=>L(t.code),className:"mt-3 rounded-lg border border-dashed border-gray-300 px-3 py-2 text-sm text-gray-500 transition-colors hover:border-primary-300 hover:text-primary-600",children:"+ Add Trip"})]})]},t.code)})}),D&&p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 px-4",children:e.jsxs("form",{onSubmit:R,className:"w-full max-w-lg max-h-[90vh] overflow-y-auto space-y-4 rounded-xl border border-gray-200 bg-white p-6 shadow-xl",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:[h?"Edit Trip":"New Trip"," —"," ",v.find(t=>t.code===p)?.country_name]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"City"}),e.jsx("input",{required:!0,value:s.city,onChange:t=>o({...s,city:t.target.value}),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Date Range"}),e.jsx("input",{required:!0,placeholder:"Jan 2024",value:s.date_range,onChange:t=>o({...s,date_range:t.target.value}),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Purpose"}),e.jsx("input",{required:!0,value:s.purpose,onChange:t=>o({...s,purpose:t.target.value}),className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Category"}),e.jsx("input",{required:!0,value:s.category,onChange:t=>o({...s,category:t.target.value}),className:l,placeholder:"sports, education, ..."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:s.description,onChange:t=>o({...s,description:t.target.value}),rows:3,className:l})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Highlights (comma-separated)"}),e.jsx("input",{value:s.highlights,onChange:t=>o({...s,highlights:t.target.value}),className:l,placeholder:"Sightseeing, Food, Culture"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Image URL (optional)"}),e.jsx("input",{value:s.image_url,onChange:t=>o({...s,image_url:t.target.value}),className:l})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"submit",disabled:y,className:"rounded-lg bg-primary-500 px-4 py-2 text-sm font-medium text-white hover:bg-primary-600 disabled:opacity-50",children:y?"Saving...":h?"Update":"Create"}),e.jsx("button",{type:"button",onClick:S,className:"rounded-lg px-4 py-2 text-sm text-gray-600 hover:bg-gray-100",children:"Cancel"})]})]})})]})}export{z as default};
